#' Openrouteservice Directions
#'
#' Get directions for different modes of transport.
#'
#' @param coordinates List of `longitude, latitude` coordinate pairs visited in
#'   order.
#' @template param-profile
#' @param format Response format, defaults to `"json"`
#' @template param-common
#' @templateVar dotsargs parameters
#' @templateVar endpoint directions
#' @return Route between two or more locations for a selected profile and its
#'   settings as GeoJSON response.
#' @examples
#' coordinates = list(c(8.34234, 48.23424), c(8.34423, 48.26424))
#'
#' # simple call
#' ors_directions(coordinates, preference="fastest")

#' # sf output
#' ors_directions(coordinates, preference="fastest", output_sf = TRUE)

#' # customized options
#' ors_directions(coordinates, profile="cycling-mountain", elevation=TRUE, format="geojson")
#' @template author
#' @export
ors_directions <- function(coordinates,
                           profile = c('driving-car', 'driving-hgv', 'cycling-regular', 'cycling-road', 'cycling-safe', 'cycling-mountain', 'cycling-tour', 'cycling-electric', 'foot-walking', 'foot-hiking', 'wheelchair'),
                           format = c('json', 'geojson', 'gpx'),
                           ...,
                           api_key = ors_api_key(),
                           parse_output = NULL,
                           output_sf = FALSE) {
  if (missing(coordinates))
    stop('Missing argument "coordinates"')

  profile = match.arg(profile)

  if(output_sf) {
    format = "geojson"
  } else {
    format = match.arg(format)
  }
  response_format = switch(format, 'gpx'='xml', 'json')

  params = list(coordinates = coordinates, profile = profile, format = format, ...)

  query = api_query(api_key, params)
  if(output_sf) {
    a = api_call("directions", "GET", query, response_format = response_format, parse_output = FALSE)
    geojsonsf::geojson_sf(a)
  } else {
    api_call("directions", "GET", query, response_format = response_format, parse_output = parse_output)
  }
}
